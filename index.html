<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scan Barcode</title>
  </head>
  <body>
    <h1>Welcome to Scan Barcode</h1>
    <div
      style="
        display: flex;
        flex-direction: column;
        align-items: start;
        gap: 20px;
      "
    >
      <div>
        <img
          src="data:image/gif;base64,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"
          alt="Barcode Image"
          style="max-width: 200px; height: auto"
        />
      </div>
      <form>
        <label for="serial_number">Serial Number:</label><br />
        <input type="text" id="serial_number" name="serial_number" /><br />
        <button type="submit">Submit</button>
      </form>
    </div>
    <div id="scan-box" style="margin: 2rem 0">
      <video
        id="bugCam"
        playsinline
        muted
        style="max-width: 280px; display: none"
      ></video
      ><br />
      <button id="startScan" type="button">Scan barcode</button>
    </div>
    <script type="module">
      const video = document.getElementById("bugCam");
      const btn = document.getElementById("startScan");
      const input = document.querySelector("#serial_number"); // ← Update your selector

      btn.addEventListener("click", async () => {
        btn.disabled = true; // Prevents double-click
        video.style.display = "block";

        // 1. Request rear camera
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: { ideal: "environment" },
            width: 640,
            height: 480,
          },
        });
        video.srcObject = stream;
        await video.play();

        // 2. Try native API; if not – ZXing
        if ("BarcodeDetector" in window) {
          const detector = new BarcodeDetector({
            formats: ["ean_13", "code_128", "qr_code"],
          });
          const tick = async () => {
            const codes = await detector.detect(video);
            if (codes.length) return finish(codes[0].rawValue);
            requestAnimationFrame(tick);
          };
          tick();
        } else {
          const { BrowserMultiFormatReader } = await import(
            "https://cdn.jsdelivr.net/npm/@zxing/browser@0.0.18/+esm"
          );
          const reader = new BrowserMultiFormatReader();
          reader.decodeFromVideoElement(video, (res) => {
            if (res) {
              finish(res.getText());
              reader.reset();
            }
          });
        }

        function finish(code) {
          input.value = code; // writing to the form
          btn.textContent = "Found: " + code;
          stream.getTracks().forEach((t) => t.stop()); // turning off the camera
          video.remove();
        }
      });
    </script>
  </body>
</html>
